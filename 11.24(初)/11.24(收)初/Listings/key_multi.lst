C51 COMPILER V9.54   KEY_MULTI                                                             12/03/2024 15:50:04 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE KEY_MULTI
OBJECT MODULE PLACED IN .\Objects\key_multi.obj
COMPILER INVOKED BY: E:\Keil5\C51\BIN\C51.EXE key_multi.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\k
                    -ey_multi.lst) OBJECT(.\Objects\key_multi.obj)

line level    source

   1          #include <key_multi.h>
   2          
   3          unsigned char keyscan()
   4          {
   5   1              unsigned char keynumber;
   6   1              if(!KEY1) keynumber = 1;                                                                //£¡£¡£¡ÐÞ¸Ä´Ë´¦£¬¿ÉÒÔÔö¼Ó/¼õÉÙ°´¼üÊýÁ¿
   7   1              else if(!KEY2) keynumber = 2;                                                   //£¡£¡£¡ÐÞ¸Ä´Ë´¦£¬¿ÉÒÔÔö¼Ó/¼õÉÙ°´¼üÊýÁ¿
   8   1              else if(!KEY3) keynumber = 3;                                                   //£¡£¡£¡ÐÞ¸Ä´Ë´¦£¬¿ÉÒÔÔö¼Ó/¼õÉÙ°´¼üÊýÁ¿
   9   1              else if(!KEY4) keynumber = 4;                                                   //£¡£¡£¡ÐÞ¸Ä´Ë´¦£¬¿ÉÒÔÔö¼Ó/¼õÉÙ°´¼üÊýÁ¿
  10   1              else keynumber = 0;
  11   1              return keynumber;
  12   1      }
  13          
  14          unsigned char key_multi(void)
  15          {
  16   1              static uchar key_state;                                                                         //°´¼ü×´Ì¬±äÁ¿
  17   1              static uint key_time;                                                                           //°´¼ü¼ÆÊ±±äÁ¿
  18   1              static uchar key_press_nums;                                                    //°´¼ü´ÎÊý±äÁ¿          
  19   1              static uint key_time_double;                                                    //°´¼üË«»÷Ê±¼ä
  20   1              static uchar keynum;                                                                                    //¼üÖµ
  21   1              static uchar new_keynum;                                                                        //ÐÂµÄ¼üÖµ
  22   1              uchar key_press, key_return;                                                    //¼üÖµºÍ·µ»ØÖµ
  23   1              
  24   1              key_return = 0;                                                                         //Çå³ý·µ»Ø°´¼üÖµ
  25   1              
  26   1              switch(keyscan())
  27   1              {
  28   2                      case 1:key_press = KEY1;new_keynum = 1;break;           
  29   2                      case 2:key_press = KEY2;new_keynum = 2;break;           
  30   2                      case 3:key_press = KEY3;new_keynum = 3;break;           
  31   2                      case 4:key_press = KEY4;new_keynum = 4;break;           
  32   2                      default:key_press = 1;break;
  33   2              }
  34   1              if(key_press_nums > 0)                                                                          //°´¼ü´ÎÊý´óÓÚ0£¬ËµÃ÷ÓÐ°´¼ü
  35   1              {
  36   2                      key_time_double++;                                                                                      //Ë«»÷¼ÆÊ±
  37   2                      if(key_time_double >= DOUBLE_KEY_TIME && key_time_double < LONG_KEY_TIME) key_state = KEY_STATE_2;//ÔÚ³¤
             -°´Ê±¼äºÍË«»÷Ê±¼äÉè¶¨·¶Î§ÄÚ£¬µ½×´Ì¬2
  38   2              }
  39   1              
  40   1              switch (key_state)
  41   1              {
  42   2                      case KEY_STATE_0:                                                                                       //°´¼ü×´Ì¬0£ºÅÐ¶ÏÓÐÎÞ°´¼ü°´ÏÂ
  43   2                      {
  44   3                              if (!key_press)                                                                                         //ÓÐ°´¼ü°´ÏÂ
  45   3                              {
  46   4                                      key_time = 0;                                                                                   //ÇåÁãÊ±¼ä¼ä¸ô¼ÆÊý
  47   4                                      key_state = KEY_STATE_1;                                                //È»ºó½øÈë °´¼ü×´Ì¬1
  48   4                              }
  49   3                      }break;
  50   2                      case KEY_STATE_1:                                                                                       //°´¼ü×´Ì¬1£ºÈí¼þÏû¶¶(È·¶¨°´¼üÊÇ·ñÓÐÐ§£¬¶ø²»ÊÇÎó´¥)¡£°´¼üÓÐÐ§µÄ¶¨Òå£º°´¼ü³Ö
             -Ðø°´ÏÂ³¬¹ýÉè¶¨µÄÏû¶¶Ê±¼ä¡£
  51   2                      {
  52   3                              if (!key_press)
C51 COMPILER V9.54   KEY_MULTI                                                             12/03/2024 15:50:04 PAGE 2   

  53   3                              {
  54   4                                      key_time++;                                                                                             //Ò»´Î10ms
  55   4                                      if(key_time>=SINGLE_KEY_TIME)                   //Ïû¶¶Ê±¼äÎª£ºSINGLE_KEY_TIME*10ms = 10ms;
  56   4                                      {
  57   5                                              key_state = KEY_STATE_2;                                        //Èç¹û°´¼üÊ±¼ä³¬¹ý Ïû¶¶Ê±¼ä£¬¼´ÅÐ¶¨Îª°´ÏÂµÄ°´¼üÓÐÐ§¡£½øÈë°´¼ü×´Ì¬2£¬¼ÌÐ
             -øÅÐ¶¨µ½µ×ÊÇµ¥»÷¡¢Ë«»÷»¹ÊÇ³¤°´
  58   5                                              key_press_nums++;                                                                       //°´¼ü´ÎÊý+1
  59   5                                      }
  60   4                              }
  61   3                              else key_state = KEY_STATE_0;                           //Èç¹û°´¼üÊ±¼äÃ»ÓÐ³¬¹ý£¬ÅÐ¶¨ÎªÎó´¥£¬°´¼üÎÞÐ§£¬·µ»Ø °´¼ü×´Ì¬0£¬¼ÌÐøµÈ´
             -ý°´¼ü
  62   3                      }break;
  63   2                      case KEY_STATE_2:                                                                                       //°´¼ü×´Ì¬2£ºÅÐ¶¨°´¼üÓÐÐ§µÄÖÖÀà£ºÊÇµ¥»÷£¬Ë«»÷£¬»¹ÊÇ³¤°´
  64   2                      {
  65   3                              if(key_press)                                                                                           //Èç¹û°´¼üÔÚ Éè¶¨µÄË«»÷Ê±¼äÄÚÊÍ·Å£¬ÔòÅÐ¶¨Îªµ¥»÷/Ë«»÷
  66   3                              {
  67   4                                      if(key_time_double < 50 ) key_state = KEY_STATE_0;                                                      //Ë«»÷Ê±¼ä´ïµ½Ç°£¬ÔÙ´ÎÉ¨Ãè°´¼ü
  68   4                                      if(key_time_double >= 50 && key_time_double < 80)       //´ïµ½Ë«»÷Éè¶¨Ê±¼äºó
  69   4                                      {
  70   5                                              if(key_press_nums == 1) 
  71   5                                                      key_return = Single_click + new_keynum*10;                              //·µ»ØÓÐÐ§°´¼üÖµ£ºµ¥»÷
  72   5                                              else if(key_press_nums ==2 && new_keynum == keynum) 
  73   5                                                      key_return = Double_click + new_keynum*10;      //·µ»ØÓÐÐ§°´¼üÖµ£ºË«»÷
  74   5                                              key_state = KEY_STATE_0;                                        //·µ»Ø °´¼ü×´Ì¬0£¬¼ÌÐøµÈ´ý°´¼ü
  75   5                                              key_press_nums = 0;                                                             //Çå¿Õ°´¼ü´ÎÊý
  76   5                                              key_time_double = 0;                                                    //Çå¿ÕË«»÷¼ÆÊ±
  77   5                                      }
  78   4                              }
  79   3                              else
  80   3                              {       
  81   4                                      key_time++;                                                                                                     //°´¼üÒ»Ö±°´×ÅµÄ»°£¬³¤°´¼ÆÊ±
  82   4                                      if(key_time >= LONG_KEY_TIME)                   //Èç¹û°´¼üÊ±¼ä³¬¹ý Éè¶¨µÄ³¤°´Ê±¼ä(LONG_KEY_TIME*10ms=80*10ms=800ms), 
             -ÔòÅÐ¶¨Îª ³¤°´
  83   4                                      {
  84   5                                              key_return = Long_click + new_keynum*10;        //·µ»ØÓÐÐ§¼üÖµÖµ£º³¤°´
  85   5                                              key_state = KEY_STATE_3;                                        //È¥×´Ì¬3£¬µÈ´ý°´¼üÊÍ·Å
  86   5                                      }
  87   4                              }
  88   3                      }break;
  89   2                      case KEY_STATE_3:                                                                                       //µÈ´ý°´¼üÊÍ·Å
  90   2                      {
  91   3                              if (key_press)
  92   3                              {
  93   4                                      key_state = KEY_STATE_0;                                                //°´¼üÊÍ·Åºó£¬½øÈë °´¼ü×´Ì¬0 £¬½øÐÐÏÂÒ»´Î°´¼üµÄÅÐ¶¨
  94   4                                      key_press_nums = 0;                                                                     //Çå¿Õ°´¼ü´ÎÊý
  95   4                                      key_time_double = 0;                                                            //Çå¿ÕË«»÷¼ÆÊ±
  96   4                              }
  97   3                      }break;
  98   2                      default:key_state = KEY_STATE_0;break;  //ÌØÊâÇé¿ö£ºkey_stateÊÇÆäËûÖµµÃÇé¿ö£¬ÇåÁãkey_state¡£ÕâÖÖÇé¿öÒ»°ã³
             -öÏÖÔÚ Ã»ÓÐ³õÊ¼»¯key_state£¬µÚÒ»´ÎÖ´ÐÐÕâ¸öº¯ÊýµÄÊ±ºò
  99   2              }
 100   1              keynum = new_keynum;                                                                                    //½«ÐÂ»ñÈ¡µÄ¼üÖµ¸³Öµ¸ø¼üÖµ
 101   1              return key_return;                                                                                              //·µ»Ø °´¼üÖµ
 102   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    324    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8    ----
C51 COMPILER V9.54   KEY_MULTI                                                             12/03/2024 15:50:04 PAGE 3   

   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
